<div class="issue-component">
  <div class="issue-component__view">
    <div class="issue-component__view__header">
      <h4>Issues</h4>
      <input type="text" class="issue-component__view__header__search-input" [(ngModel)]="searchTerm">
      <button mat-button (click)="search()">
        <mat-icon>search</mat-icon>
        Search
      </button>
      <div class="issue-component__view__header__multiselect">
        <mat-form-field>
          <mat-label>Projects</mat-label>
          <mat-select [formControl]="toppings" multiple>
            @for (project of projectsList; track project.id) {
              <mat-option [value]="project.id">{{ project.code }}</mat-option>
            }
          </mat-select>
        </mat-form-field>
      </div>
    </div>
    <div>
      @if (isLoading()) {
        <mat-progress-bar mode="indeterminate"></mat-progress-bar>
      }
      <div cdkDropListGroup class="issue-component__view__content">
        <div class="example-container">
          <h2>Backlog</h2>
          <div
            cdkDropList
            [cdkDropListData]="issues()"
            id="backlog-list"
            class="example-list"
            (cdkDropListDropped)="drop($event)">
            @if (projectIds.length > 0) {
              @for (item of issues(); track item) {
                @if (item.stage == "Backlog") {
                  <div class="example-box" cdkDrag>
                    <p>{{ item.projectCode }} - {{ item.name }}</p>
                    <p>{{ item.stage }}</p>
                    <p>{{ item.state }}</p>
                  </div>
                }
              }
            }
          </div>
        </div>
        <div class="example-container">
          <h2>To do</h2>
          <div
            cdkDropList
            [cdkDropListData]="todo()"
            id="todo-list"
            class="example-list"
            (cdkDropListDropped)="drop($event)">
            @if (projectIds.length > 0) {
              @for (item of todo(); track item) {
                @if (item.stage == "ToDo") {
                  <div class="example-box" cdkDrag>
                    <p>{{ item.projectCode }} - {{ item.name }}</p>
                    <p>{{ item.stage }}</p>
                    <p>{{ item.state }}</p>
                  </div>
                }
              }
            }
          </div>
        </div>
        <div class="example-container">
          <h2>In Progress</h2>
          <div
            cdkDropList
            [cdkDropListData]="inprogress()"
            id="inprogress-list"
            class="example-list"
            (cdkDropListDropped)="drop($event)">
            @if (projectIds.length > 0) {
              @for (item of inprogress(); track item) {
                @if (item.stage == "InProgress") {
                  <div class="example-box" cdkDrag>
                    <p>{{ item.projectCode }} - {{ item.name }}</p>
                    <p>{{ item.stage }}</p>
                    <p>{{ item.state }}</p>
                  </div>
                }
              }
            }
          </div>
        </div>
        <div class="example-container">
          <h2>Done</h2>
          <div
            cdkDropList
            [cdkDropListData]="done()"
            id="done-list"
            class="example-list"
            (cdkDropListDropped)="drop($event)">
            @if (projectIds.length > 0) {
              @for (item of done(); track item) {
                @if (item.stage == "Done") {
                  <div class="example-box" cdkDrag>
                    <p>{{ item.projectCode }} - {{ item.name }}</p>
                    <p>{{ item.stage }}</p>
                    <p>{{ item.state }}</p>
                  </div>
                }
              }
            }
          </div>
        </div>
      </div>
    </div>
  </div>
</div>


